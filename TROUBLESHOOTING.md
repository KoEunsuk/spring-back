#  Troubleshooting (λ¬Έμ  ν•΄κ²° κ°€μ΄λ“)

κ°λ° κ³Όμ •μ—μ„ μμ£Ό λ°μƒν•λ” λ¬Έμ μ™€ ν•΄κ²° λ°©λ²•μ„ μ •λ¦¬ν•©λ‹λ‹¤.

---

### π¨ **λ¬Έμ  1: λ΅κ·ΈμΈ(`POST /api/auth/login`) μ‹ `401 Unauthorized` μ—λ¬ λ°μƒ**
`signup`μ€ λλ”λ° `login`λ§ μ‹¤ν¨ν•λ” κ²½μ°μ…λ‹λ‹¤.

- **μ›μΈ**: URL μ ‘κ·Ό κ¶ν• λ¬Έμ κ°€ μ•„λ‹λΌ, **λ΅κ·ΈμΈ μΈμ¦ μ μ°¨ μμ²΄μ μ‹¤ν¨**μ…λ‹λ‹¤.
- **μ²΄ν¬λ¦¬μ¤νΈ**:
    1.  **λΉ„λ°€λ²νΈ μ•”νΈν™”**: `AuthService`μ `signup` λ©”μ„λ“μ—μ„ `passwordEncoder.encode()`λ¥Ό μ‚¬μ©ν•΄ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν•΄μ„ DBμ— μ €μ¥ν–λ”μ§€ ν™•μΈν•μ„Έμ”.
    2.  **μ‚¬μ©μ(μ΄λ©”μΌ) μ΅΄μ¬ μ—¬λ¶€**: Postmanμ—μ„ μ”μ²­ν•λ” `email`μ΄ DB `users` ν…μ΄λΈ”μ— μ‹¤μ λ΅ μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•μ„Έμ”. μ¤νƒ€κ°€ μ—†λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    3.  **`SecurityConfig` κ²½λ΅ ν™•μΈ**: `.requestMatchers("/api/auth/**").permitAll()` μ„¤μ •μ΄ `AuthController`μ `@RequestMapping("/api/auth")`μ™€ μ •ν™•ν μΌμΉν•λ”μ§€ λ‹¤μ‹ ν™•μΈν•μ„Έμ”.

---

### π¨ **λ¬Έμ  2: API μ‘λ‹µμ΄ μ¤μ§€ μ•κ³  `HttpMediaTypeNotAcceptableException` λ°μƒ**
- **μ›μΈ**: μ„λ²„κ°€ Java κ°μ²΄λ¥Ό **JSONμΌλ΅ λ³€ν™ν•λ” λ° μ‹¤ν¨**ν• κ²½μ°μ…λ‹λ‹¤.
- **μ²΄ν¬λ¦¬μ¤νΈ**:
    1.  **`jackson-databind` λΌμ΄λΈλ¬λ¦¬ ν™•μΈ**: `build.gradle`μ— `implementation 'org.springframework.boot:spring-boot-starter-web'` μμ΅΄μ„±μ΄ μ λ€λ΅ ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    2.  **DTOμ— `@Getter` ν™•μΈ**: ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µμΌλ΅ λ³΄λ‚Ό DTO ν΄λμ¤(μ: `JwtResponseDto`, `UserDetailDto`)μ— **`@Getter` μ–΄λ…Έν…μ΄μ…μ΄ λΉ μ΅λ”μ§€** ν™•μΈν•μ„Έμ”. Jacksonμ€ getterλ¥Ό ν†µν•΄ ν•„λ“ κ°’μ„ μ½μ–΄μµλ‹λ‹¤.

---

### π¨ **λ¬Έμ  3: λΉ„λ°€λ²νΈ λ³€κ²½ ν›„μ—λ„ μ›λ‚  ν† ν°μ΄ κ³„μ† μ‚¬μ©λ¨**
- **μ›μΈ**: ν† ν° λ¬΄ν¨ν™” λ΅μ§μ μ‹κ°„ λΉ„κµ(`tokenIssuedAt.isBefore(passwordChangedAt)`)κ°€ `false`λ΅ ν‰κ°€λλ” κ²½μ°μ…λ‹λ‹¤.
- **μ²΄ν¬λ¦¬μ¤νΈ**:
    1.  **μ‹κ°„ κΈ°λ΅ ν™•μΈ**: λΉ„λ°€λ²νΈ λ³€κ²½ ν›„, DB `users` ν…μ΄λΈ”μ `password_changed_at` μ»¬λΌμ— **UTC κΈ°μ¤€μ ν„μ¬ μ‹κ°„**μ΄ μ λ€λ΅ κΈ°λ΅λμ—λ”μ§€ ν™•μΈν•μ„Έμ”. `null`μ΄λΌλ©΄ `UserService`μ `changeMyPassword` λ©”μ„λ“μ— μ‹κ°„ κΈ°λ΅ λ΅μ§μ΄ λ„λ½λ κ²ƒμ…λ‹λ‹¤.
    2.  **`Instant` νƒ€μ… ν†µμΌ**: μ‹κ°„ κ΄€λ ¨ ν•„λ“(`passwordChangedAt`, ν† ν° μƒμ„± μ‹μ  λ“±)λ¥Ό λ¨λ‘ νƒ€μ„μ΅΄ λ¬Έμ μ—μ„ μμ λ΅μ΄ `Instant` νƒ€μ…μΌλ΅ ν†µμΌν–λ”μ§€ ν™•μΈν•μ„Έμ”. `LocalDateTime`κ³Ό `Date`λ¥Ό νΌμ©ν•λ©΄ λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.
    3.  **ν…μ¤νΈ μ μ°¨ ν™•μΈ**: 'μ›λ‚  ν† ν°'μ„ μ •ν™•ν λ³µμ‚¬ν•΄λ‘κ³  ν…μ¤νΈν•λ”μ§€ ν™•μΈν•μ„Έμ”. μ‹¤μλ΅ λΉ„λ°€λ²νΈ λ³€κ²½ ν›„ μƒλ΅ λ΅κ·ΈμΈν•΄μ„ λ°›μ€ 'μƒ ν† ν°'μΌλ΅ ν…μ¤νΈν•κ³  μμ„ μ μμµλ‹λ‹¤.
- **μ°Έκ³ **:
  - java.time ν¨ν‚¤μ§€μ λ‹¤λ¥Έ νƒ€μ…λ“¤μ€ μ•„λμ™€ κ°™μ€ λ©μ μ— λ§κ² μ‚¬μ©ν•μ‹λ©΄ λ©λ‹λ‹¤.
    1. Instant: νΉμ • μ‹μ  (Timestamp). UTC κΈ°μ¤€μ΄λ©°, μ‹κ°„λ€ λ¬Έμ μ—μ„ μμ λ΅­μµλ‹λ‹¤.
       - μ‚¬μ© μμ‹: createdAt, updatedAt, passwordChangedAt, actualDepartureTime (μ‹¤μ  μ¶λ° μ‹κ°), actualArrivalTime (μ‹¤μ  λ„μ°© μ‹κ°)
    2. LocalDate: μ‹κ°„μ΄λ‚ μ‹κ°„λ€ μ •λ³΄κ°€ μ—†λ” λ‚ μ§. 
       - μ‚¬μ© μμ‹: birthDate (μƒλ…„μ›”μΌ), dispatchDate (λ°°μ°¨ μΌμ)
    3. LocalTime: λ‚ μ§λ‚ μ‹κ°„λ€ μ •λ³΄κ°€ μ—†λ” μ‹κ°„.
       - μ‚¬μ© μμ‹: openingHour (μμ—… μ‹μ‘ μ‹κ°„), scheduledDeparture (μμ • μ¶λ° μ‹κ°„)

---

### π¨ **λ¬Έμ  4: `LazyInitializationException` λ°μƒ**
- **μ›μΈ**: `@Transactional` λ²”μ„ λ°–μ—μ„ μ§€μ—° λ΅λ”©(`FetchType.LAZY`)μΌλ΅ μ„¤μ •λ μ—°κ΄€ μ—”ν‹°ν‹°μ— μ ‘κ·Όν•λ ¤κ³  ν•  λ• λ°μƒν•©λ‹λ‹¤.
- **ν•΄κ²°μ±…**:
    - μ—°κ΄€λ μ—”ν‹°ν‹°μ ν•„λ“μ— μ ‘κ·Όν•λ” λ¨λ“  λ΅μ§(μ: DTO λ³€ν™)μ€ **λ°λ“μ‹ `@Transactional`μ΄ λ¶™μ€ μ„λΉ„μ¤ λ©”μ„λ“ μ•μ—μ„** λ¨λ‘ μ™„λ£ν•΄μ•Ό ν•©λ‹λ‹¤.
    - μ»¨νΈλ΅¤λ¬λ‚ λ·°(View) κ³„μΈµμ—μ„ μ—”ν‹°ν‹°μ lazy-loading ν•„λ“μ— μ§μ ‘ μ ‘κ·Όν•μ§€ λ§μ„Έμ”.

---

### π¨ **λ¬Έμ  5: `NullPointerException` λ°μƒ**
- **μ›μΈ 1: μ»¬λ ‰μ… λ―Έμ΄κΈ°ν™”**: `@OneToMany` ν•„λ“λ¥Ό `new ArrayList<>()`λ΅ μ΄κΈ°ν™”ν•μ§€ μ•μ€ μƒνƒμ—μ„ `.getUsers().add()`λ¥Ό νΈμ¶ν•λ” κ²½μ°.
- **μ›μΈ 2: μ—°κ΄€ μ—”ν‹°ν‹° λ―Έν™•μΈ**: DTO λ³€ν™ μ‹ `user.getOperator().getId()`μ²λΌ μ—°κ΄€ κ°μ²΄κ°€ `null`μΌ κ°€λ¥μ„±μ„ ν™•μΈν•μ§€ μ•κ³  λ°”λ΅ λ©”μ„λ“λ¥Ό νΈμ¶ν•λ” κ²½μ°.
- **ν•΄κ²°μ±…**:
    - λ¨λ“  `@OneToMany` ν•„λ“λ” `private List<Type> items = new ArrayList<>();` μ™€ κ°™μ΄ μ„ μ–Έκ³Ό λ™μ‹μ— μ΄κΈ°ν™”ν•©λ‹λ‹¤.
    - DTO λ³€ν™ λ΅μ§ λ“±μ—μ„ λ‹¤λ¥Έ μ—”ν‹°ν‹°μ— μ ‘κ·Όν•  λ•λ” ν•­μƒ `if (user.getOperator() != null)` κ³Ό κ°™μ€ null μ²΄ν¬λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.